<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Fish%20Tally%22,%22short_name%22:%22FishTally%22,%22description%22:%22Track%20your%20fishing%20catches%20and%20memories%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23000000%22,%22theme_color%22:%22%23000000%22,%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23000'/%3E%3Ctext x='50' y='60' font-size='50' text-anchor='middle' fill='gold'%3EðŸŽ£%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22},{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23000'/%3E%3Ctext x='50' y='60' font-size='50' text-anchor='middle' fill='gold'%3EðŸŽ£%3C/text%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22}]}">
    <title>Fish Tally</title>
    <style>
        body {
            background-color: #000;
            color: #f0d68c;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            background: #8b0000;
        }
        .tab-button {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            background: #8b0000;
            color: gold;
            border: none;
            cursor: pointer;
        }
        .tab-button.active {
            background: #b22222;
        }
        .tab-content {
            padding: 10px;
        }
        .season-total {
            background: #330000;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
        }
        .fish-item {
            margin-bottom: 10px;
            border: 1px solid #444;
            border-radius: 5px;
        }
        .fish-title {
            font-weight: bold;
            cursor: pointer;
            background: #330000;
            padding: 10px;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .fish-title:hover {
            background: #440000;
        }
        .fish-count {
            background: #8b0000;
            color: gold;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 14px;
            min-width: 30px;
            text-align: center;
        }
        .fish-info {
            background: #1a0000;
            padding: 15px;
            margin-top: 5px;
            display: none;
            font-size: 14px;
        }
        .fish-info.active {
            display: block;
        }
        .buttons {
            margin: 10px 0;
            text-align: center;
        }
        .buttons button {
            margin: 0 5px;
            padding: 8px 15px;
            color: black;
            background-color: gold;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
        }
        .buttons button:hover {
            background-color: #ffd700;
        }
        .bait-rigging {
            margin-top: 10px;
            padding: 10px;
            background: #2a0000;
            border-radius: 3px;
        }
        .bait-rigging h4 {
            margin: 0 0 5px 0;
            color: #ffd700;
        }
        .bait-rigging p {
            margin: 5px 0;
        }
        textarea {
            width: calc(100% - 20px);
            height: 150px;
            background: #1a0000;
            color: gold;
            border: 1px solid #444;
            padding: 10px;
            border-radius: 5px;
            resize: vertical;
            font-family: Arial, sans-serif;
            margin-bottom: 10px;
        }
        .notes-list {
            margin-top: 10px;
        }
        .note-item {
            background: #330000;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
            font-size: 14px;
        }
        .note-date {
            color: #b8860b;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .note-text {
            white-space: pre-wrap;
        }
        .note-delete {
            position: absolute;
            top: 8px;
            right: 8px;
            background: red;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            line-height: 20px;
            text-align: center;
        }
        .save-note-btn {
            background: #8b0000;
            color: gold;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .save-note-btn:hover {
            background: #a00000;
        }
        .photo-upload {
            margin: 20px 0;
        }
        .photo-upload label {
            display: block;
            background: #8b0000;
            color: gold;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .photo-upload input[type="file"] {
            display: none;
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .photo-container {
            position: relative;
        }
        .photo {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border: 2px solid gold;
            border-radius: 5px;
            cursor: pointer;
        }
        .photo-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .reset-btn {
            background: #8b0000 !important;
            color: gold !important;
            padding: 15px 20px;
            font-size: 16px;
            margin-top: 20px;
            width: 100%;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        .reset-btn:hover {
            background: #a00000 !important;
        }
        .debug {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #333;
            color: white;
            padding: 5px;
            font-size: 12px;
            border-radius: 3px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="debugInfo" class="debug">Debug: Loading...</div>

    <div class="tabs">
        <button id="tabTally" class="tab-button active">Tally</button>
        <button id="tabNotes" class="tab-button">Memories</button>
    </div>

    <div id="tallyTab" class="tab-content">
        <div class="season-total">
            Season Total: <span id="grandTotal">0</span> Fish
        </div>
        <div id="fishList"></div>
        <button id="resetBtn" class="reset-btn">Reset Season</button>
    </div>

    <div id="notesTab" class="tab-content" style="display: none;">
        <textarea id="noteInput" placeholder="Write your memories and notes here..."></textarea>
        <button id="saveNoteBtn" class="save-note-btn">Save Note</button>
        <div class="notes-list" id="notesList"></div>

        <div class="photo-upload">
            <label for="photoInput">Add Photo</label>
            <input type="file" id="photoInput" accept="image/*" multiple />
        </div>
        <div class="gallery" id="photoGallery"></div>
    </div>
        <textarea id="noteInput" placeholder="Write a memory or note about your fishing..."></textarea>
        <button id="saveNoteBtn" class="save-note-btn">Save Memory</button>
        <div class="notes-list" id="notesList"></div>

        <div class="photo-upload">
            <label for="photoInput">Upload Photo</label>
            <input type="file" id="photoInput" accept="image/*" multiple />
        </div>
        <div class="gallery" id="photoGallery"></div>
    </div>

    <script>
        // Data structure for fish species
        const fishData = [
            {
                name: "Largemouth Bass",
                rig: "Texas Rig, Wacky Rig",
                bait: "Plastic worms, Jigs, Crankbaits"
            },
            {
                name: "Smallmouth Bass",
                rig: "Drop Shot, Jigging",
                bait: "Minnows, Crawlers, Soft plastics"
            },
            {
                name: "Rainbow Trout",
                rig: "Spinners, Fly Fishing",
                bait: "PowerBait, Worms, Salmon eggs"
            },
            {
                name: "Northern Pike",
                rig: "Spinnerbait, Live bait rig",
                bait: "Minnows, Large soft plastics"
            },
            {
                name: "Walleye",
                rig: "Slip Bobber, Jigging",
                bait: "Minnows, Nightcrawlers"
            },
            {
                name: "Crappie",
                rig: "Jigging, Slip Bobber",
                bait: "Minnows, Soft plastics"
            },
            {
                name: "Bluegill",
                rig: "Bobber and hook",
                bait: "Worms, Crickets"
            }
        ];

        // State
        let fishCounts = {};
        let notes = [];
        let photos = [];

        // DOM Elements
        const fishListEl = document.getElementById('fishList');
        const grandTotalEl = document.getElementById('grandTotal');
        const resetBtn = document.getElementById('resetBtn');
        const tabTally = document.getElementById('tabTally');
        const tabNotes = document.getElementById('tabNotes');
        const tallyTab = document.getElementById('tallyTab');
        const notesTab = document.getElementById('notesTab');
        const noteInput = document.getElementById('noteInput');
        const saveNoteBtn = document.getElementById('saveNoteBtn');
        const notesList = document.getElementById('notesList');
        const photoInput = document.getElementById('photoInput');
        const photoGallery = document.getElementById('photoGallery');
        const debugInfo = document.getElementById('debugInfo');

        // Utility to save/load from localStorage
        function saveState() {
            localStorage.setItem('fishCounts', JSON.stringify(fishCounts));
            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.setItem('photos', JSON.stringify(photos));
            debugLog("State saved.");
        }

        function loadState() {
            const savedFishCounts = localStorage.getItem('fishCounts');
            const savedNotes = localStorage.getItem('notes');
            const savedPhotos = localStorage.getItem('photos');
            if (savedFishCounts) fishCounts = JSON.parse(savedFishCounts);
            if (savedNotes) notes = JSON.parse(savedNotes);
            if (savedPhotos) photos = JSON.parse(savedPhotos);
            debugLog("State loaded.");
        }

        // Debug logging
        function debugLog(message) {
            debugInfo.textContent = "Debug: " + message;
            // Clear debug message after 3 seconds
            setTimeout(() => {
                debugInfo.textContent = "";
            }, 3000);
        }

        // Render fish list
        function renderFishList() {
            fishListEl.innerHTML = '';
            let totalFish = 0;
            fishData.forEach(fish => {
                const count = fishCounts[fish.name] || 0;
                totalFish += count;

                const fishItem = document.createElement('div');
                fishItem.className = 'fish-item';

                const title = document.createElement('div');
                title.className = 'fish-title';
                title.textContent = fish.name;

                const countBadge = document.createElement('span');
                countBadge.className = 'fish-count';
                countBadge.textContent = count;

                title.appendChild(countBadge);
                fishItem.appendChild(title);

                // Expandable info
                const info = document.createElement('div');
                info.className = 'fish-info';

                const rigging = document.createElement('div');
                rigging.className = 'bait-rigging';
                rigging.innerHTML = `<h4>Recommended Rigging:</h4><p>${fish.rig}</p><h4>Recommended Baits:</h4><p>${fish.bait}</p>`;
                info.appendChild(rigging);

                // Buttons: +1, -1, Reset
                const buttonsDiv = document.createElement('div');
                buttonsDiv.className = 'buttons';

                const addBtn = document.createElement('button');
                addBtn.textContent = '+1';
                addBtn.addEventListener('click', () => {
                    fishCounts[fish.name] = (fishCounts[fish.name] || 0) + 1;
                    saveState();
                    renderFishList();
                });

                const subBtn = document.createElement('button');
                subBtn.textContent = '-1';
                subBtn.addEventListener('click', () => {
                    fishCounts[fish.name] = Math.max((fishCounts[fish.name] || 0) - 1, 0);
                    saveState();
                    renderFishList();
                });

                const resetFishBtn = document.createElement('button');
                resetFishBtn.textContent = 'Reset';
                resetFishBtn.addEventListener('click', () => {
                    fishCounts[fish.name] = 0;
                    saveState();
                    renderFishList();
                });

                buttonsDiv.appendChild(addBtn);
                buttonsDiv.appendChild(subBtn);
                buttonsDiv.appendChild(resetFishBtn);
                info.appendChild(buttonsDiv);

                fishItem.appendChild(info);

                // Toggle info on title click
                title.addEventListener('click', () => {
                    info.classList.toggle('active');
                });

                fishListEl.appendChild(fishItem);
            });

            grandTotalEl.textContent = totalFish;
        }

        // Render notes list
        function renderNotes() {
            notesList.innerHTML = '';
            notes.forEach((note, index) => {
                const noteEl = document.createElement('div');
                noteEl.className = 'note-item';

                const dateEl = document.createElement('div');
                dateEl.className = 'note-date';
                dateEl.textContent = new Date(note.date).toLocaleString();

                const textEl = document.createElement('div');
                textEl.className = 'note-text';
                textEl.textContent = note.text;

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'note-delete';
                deleteBtn.textContent = 'Ã—';
                deleteBtn.title = "Delete Memory";
                deleteBtn.addEventListener('click', () => {
                    notes.splice(index, 1);
                    saveState();
                    renderNotes();
                });

                noteEl.appendChild(dateEl);
                noteEl.appendChild(textEl);
                noteEl.appendChild(deleteBtn);
                notesList.appendChild(noteEl);
            });
        }

        // Render photo gallery
        function renderPhotos() {
            photoGallery.innerHTML = '';
            photos.forEach((photo, index) => {
                const container = document.createElement('div');
                container.className = 'photo-container';

                const img = document.createElement('img');
                img.src = photo.dataUrl;
                img.alt = "Fishing Photo";
                img.className = 'photo';

                // On click, open full size in new tab
                img.addEventListener('click', () => {
                    window.open(photo.dataUrl, '_blank');
                });

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'photo-delete';
                deleteBtn.textContent = 'Ã—';
                deleteBtn.title = "Delete Photo";
                deleteBtn.addEventListener('click', () => {
                    photos.splice(index, 1);
                    saveState();
                    renderPhotos();
                });

                container.appendChild(img);
                container.appendChild(deleteBtn);
                photoGallery.appendChild(container);
            });
        }

        // Save new note
        saveNoteBtn.addEventListener('click', () => {
            const text = noteInput.value.trim();
            if (!text) {
                alert("Please enter some text for your memory.");
                return;
            }
            notes.push({ date: new Date().toISOString(), text });
            noteInput.value = '';
            saveState();
            renderNotes();
            debugLog("Memory saved.");
        });

        // Handle photo uploads
        photoInput.addEventListener('change', (event) => {
            const files = event.target.files;
            if (!files.length) return;

            const fileReaders = [];
            for (let file of files) {
                if (!file.type.startsWith('image/')) continue;

                const reader = new FileReader();
                reader.onload = (e) => {
                    photos.push({ dataUrl: e.target.result });
                    saveState();
                    renderPhotos();
                    debugLog("Photo added.");
                };
                reader.readAsDataURL(file);
                fileReaders.push(reader);
            }

            // Reset input to allow uploading same file again if needed
            photoInput.value = '';
        });

        // Reset season totals
        resetBtn.addEventListener('click', () => {
            if (confirm("Are you sure you want to reset all fish counts for the season?")) {
                fishCounts = {};
                saveState();
                renderFishList();
                debugLog("Season reset.");
            }
        });

        // Tab switching logic
        tabTally.addEventListener('click', () => {
            tabTally.classList.add('active');
            tabNotes.classList.remove('active');
            tallyTab.style.display = 'block';
            notesTab.style.display = 'none';
            debugLog("Switched to Tally tab.");
        });

        tabNotes.addEventListener('click', () => {
            tabNotes.classList.add('active');
            tabTally.classList.remove('active');
            notesTab.style.display = 'block';
            tallyTab.style.display = 'none';
            debugLog("Switched to Memories tab.");
        });

        // Initialization
        function init() {
            loadState();
            renderFishList();
            renderNotes();
            renderPhotos();
            debugLog("App initialized.");
        }

        init();
    </script>
</body>
</html>
